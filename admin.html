<!DOCTYPE html>
<html>
<head>
    <title>FSA Admin Page</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
</head>
<body>
    <h1>FSA Availability Management</h1>

    <!-- Dropdown to select FSA -->
    <label for="fsa-select">Select FSA:</label>
    <select id="fsa-select"></select>

    <!-- Dropdown to select availability status -->
    <label for="status-select">Select Availability:</label>
    <select id="status-select">
        <option value="0">Not Available</option>
        <option value="1">Available Now</option>
        <option value="2">Coming Soon, No Orders Yet</option>
        <option value="3">Coming Soon & Pre-Order Available</option>
        <option value="4">Under Construction</option>
    </select>

    <button onclick="updateAvailability()">Update Availability</button>

    <div id="result"></div>

    <script>
        // Firebase configuration (from your provided details)
        const firebaseConfig = {
            apiKey: "AIzaSyAldSFCZiyKLOZZzIx3BclPi4IJaG4Bnek",
            authDomain: "fsa-status.firebaseapp.com",
            projectId: "fsa-status",
            storageBucket: "fsa-status.appspot.com",
            messagingSenderId: "153479147028",
            appId: "1:153479147028:web:cf2512b8dd9411ec068101",
            measurementId: "G-Z54VGVDCHF"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Fetch the FSAs from Firestore and populate the dropdown
        const fsaSelect = document.getElementById('fsa-select');
        const fsaData = {};

        // Fetch FSA data from Firestore
        db.collection('fsas').get().then((snapshot) => {
            snapshot.forEach((doc) => {
                let fsa = doc.data();
                let option = document.createElement('option');
                option.value = doc.id;  // Use the document ID as value
                option.text = fsa.Name;  // Display the FSA Name
                fsaSelect.add(option);

                // Store FSA data in a global object
                fsaData[doc.id] = fsa;
            });
        });

        // Update FSA availability in Firestore
        function updateAvailability() {
            const selectedFSA = fsaSelect.value;
            const selectedStatus = parseInt(document.getElementById('status-select').value);

            // Update the selected FSA's availability
            db.collection('fsas').doc(selectedFSA).update({
                Availability: selectedStatus
            }).then(() => {
                displayResult(fsaData[selectedFSA], selectedStatus);
            }).catch((error) => {
                console.error('Error updating availability:', error);
                document.getElementById('result').innerHTML = 'Error updating FSA.';
            });
        }

        // Display the result after updating
        function displayResult(fsa, status) {
            const availabilityText = [
                "Not Available",
                "Available Now",
                "Coming Soon, No Orders Yet",
                "Coming Soon & Pre-Order Available",
                "Under Construction"
            ][status] || "Unknown";

            document.getElementById('result').innerHTML = `
                <p>Updated FSA: <strong>${fsa.Name}</strong></p>
                <p>New Availability: <strong>${availabilityText}</strong></p>
            `;
        }
    </script>
</body>
</html>
